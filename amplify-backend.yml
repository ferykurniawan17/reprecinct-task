version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies..."
        - ls -la
        - pwd
        - cd packages/backend-service
        - npm install
        - echo "Generating Prisma client..."
        - npx prisma generate
    build:
      commands:
        - echo "Building backend service..."
        - cd packages/backend-service
        - npm run build
        - echo "Running database migrations..."
        - npx prisma migrate deploy
    postBuild:
      commands:
        - echo "Backend build completed"
        - cd packages/backend-service
        - ls -la dist/
  artifacts:
    baseDirectory: packages/backend-service
    files:
      - dist/**/*
      - package.json
      - node_modules/**/*
      - prisma/**/*
  cache:
    paths:
      - packages/backend-service/node_modules/**/*
environment:
  variables:
    DATABASE_URL: ${DATABASE_URL}
    NODE_ENV: production
    PORT: "4000"
    CORS_ORIGIN: ${FRONTEND_URL}
    JWT_SECRET: ${JWT_SECRET}
